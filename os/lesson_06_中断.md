虽然CPU可以支持256个中断, 但是普通的PC机上只内置了两块8249芯片. 即提供了15个中断引脚.

进程的切换,键盘的输入输出, 硬盘的读写, 就是通过中断才得以实现的. 所以理解8259的工作方式是必须的.

8259芯片是可编程的, 两块芯片一块是主片, 一块是从片. 主片的端口号是0x20和0x21, 从片的端口号是0xa0和0xa1.
所谓芯片的编程, 做法与读取硬盘没有差别, 通过in/out指令按照相应的规则对端口进行读写.

对于可屏蔽中断, 通过cli/sti指令来设置FLAGS寄存器标志位, 实现中断的屏蔽和打开. clit即CLear Interrupt flag, sti即Set Interrupt flag

中断是有优先级的, 引脚IR0优先级最高,IR7优先级最低. 但是需要注意的是从片是连接到IR2引脚上. 即从片发出的中断有可能优先级高于主片.

在实模式下, 中断向量表位于内存最低的1KB空间. 每个中断在中断向量表中占2个字, 即4-byte. 4*256=1024, 即1KB的空间正好容纳256个中断. 

8259芯片为每个引脚都赋予了一个中断号, 这些中断号是可以改变的. 例如, 可以指定主片的中断号从0x08开始, 那么IR0~IR7对应的中断号分别是0x08~0x0e.


中断处理的流程:
1 保护断点的现场:将FLAGS压栈,清除IF位及TF位. CS寄存器, IP寄存器压栈.
2 执行中断处理程序. 通过中断号从内存的低1KB空间中找到中断程序的偏移地址和段地址, 分别传送到IP,CS. 
3 中断处理程序执行完毕后, 返回到断点接着执行. 所有中断处理程序的最后一条指令必须是中断返回指令iret.
  默认情况下, 中断处理程序只有一条指令, 即iret. iret会依次将IP/CS/FLAGS出栈, 然后恢复IF位及TF位.



